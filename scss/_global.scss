

$_movement: (
    nodes: ()
);

$_current-node: ();

@function new($type, $params) {
    $meta: (
        _type: $type
    );

    $instance: call($type, $params...);

    @return map-merge($instance, $meta);
}

@function mm-node-get($key) {
    @return map-get($_current-node, $key);
}

@mixin mm-node-set($key, $value) {
    $_current-node: map-merge($_current-node, ($key: $value)) !global;
}

@mixin mm-node-push($key, $value) {
    $current-list: map-get($_current-node, $key);
    $updated-list: append($current-list, $value);

    @include mm-node-set($key, $updated-list);
}

@mixin run() {
    %__temp { @content; }
}