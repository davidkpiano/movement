
@function Animation(
    $target,
    $name: $target,
    $timing: default
) {
    $animation-id: unique-id();
    $animation-target: $target;
    $animation-name: $name;
    $animation-timing: new(AnimationTiming, $timing);
    $animation-keyframe-offset: 0;
    $animation-keyframes-active: false;

    @return (
        id: $animation-id,
        target: $animation-target,
        name: $animation-name,
        timing: $animation-timing,
        keyframe-offset: $animation-keyframe-offset,
        keyframes-active: $animation-keyframes-active
    );
}

@mixin animation(
    $target: &,
    $timing: default
) {
    $animation: new(Animation, (
        target: $target,
        timing: $timing
    ), $extends: AnimationNode);

    $_current-node: map-merge($_current-node, $animation) !global;

    @include run { @content; }

    @include mm-node-set(keyframes-active, true);

    @keyframes #{map-get($animation, id)} {
        @content;
    }
}
