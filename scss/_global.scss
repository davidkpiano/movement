

$_nodes: ();

$_current-node: ();

// DEFAULTS
$_animation-timing-defaults: (
    duration: 1000ms
);

$_defaults-map: (
    timing: $_animation-timing-defaults
);


@function defaults($group, $key) {
    $group-defaults: map-get($_defaults-map, $group);

    @return map-get($group-defaults, $key);
}

@function new($type, $params, $extends: false) {
    $instance-meta: (
        _type: $type,
        _extends: $extends
    );

    $instance: ();

    @if $extends {
        $instance: map-merge($instance, new($extends, $params));
    }

    $instance: map-merge($instance, call($type, $params...));

    $instance: map-merge($instance, $instance-meta);

    @return $instance;
}

@function mm-node-get($key) {
    @return map-get($_current-node, $key);
}

@mixin mm-node-set($key, $value) {
    $_current-node: map-merge($_current-node, ($key: $value)) !global;
}

@mixin mm-node-scope($node) {
    $_previous-node: $_current-node !global;
    $_current-node: $node !global;

    @content;

    @if map-get($_previous-node, id) {
        $_current-node: $_previous-node !global;
    }
}

@mixin mm-node-push($key, $value) {
    $current-list: map-get($_current-node, $key);
    $updated-list: append($current-list, $value);

    @include mm-node-set($key, $updated-list);
}



@mixin mm-nodes-set($node) {
    $id: map-get($node, id);
    $_nodes: map-merge($_nodes, ($id: $node)) !global;
}

@function mm-nodes-get($id) {
    @return map-get($_nodes, $id);
}

@mixin run() {
    %__temp { @content; }
}