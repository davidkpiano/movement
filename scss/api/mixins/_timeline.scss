
$timeline: () !global;

@mixin _m-timeline() {
    $rendered-timeline: ();

    $target-effect-map: _group-by($timeline, 'target');

    @each $target, $effects in $target-effect-map {
        @debug _flatten(_map(_map(_map($effects, 'frames'), _map 'declarations'), _map _ary(_keys)), true);
    }

    @each $effect in $timeline {
        $target: _get($effect, 'target');

        $animation: (
            -webkit-animation-name: _get($effect, 'name'),
            -webkit-animation-duration: _get($effect, 'duration'),
            -webkit-animation-delay: _get($effect, 'delay') + _get($effect, 'offset-start'),
            -webkit-animation-iteration-count: _get($effect, 'iterations'),
            -webkit-animation-timing-function: _get($effect, 'easing'),
            -webkit-animation-fill-mode: forwards
        );

        $rendered-timeline: append($rendered-timeline, ($target: $animation));
    }

    $timeline: $rendered-timeline !global;
}